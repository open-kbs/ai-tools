(()=>{"use strict";var e={};(()=>{e.d=(t,a)=>{for(var r in a){if(e.o(a,r)&&!e.o(t,r)){Object.defineProperty(t,r,{enumerable:true,get:a[r]})}}}})();(()=>{e.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t)})();(()=>{e.r=e=>{if(typeof Symbol!=="undefined"&&Symbol.toStringTag){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}Object.defineProperty(e,"__esModule",{value:true})}})();if(typeof e!=="undefined")e.ab=__dirname+"/";var t={};e.r(t);e.d(t,{handler:()=>handler});const getActions=()=>[[/\/?googleSearch\("(.*)"\)/,async e=>{const t=e[1];try{const e=await openkbs.googleSearch(t,{});const a=e?.map((({title:e,link:t,snippet:a,pagemap:r})=>({title:e,link:t,snippet:a,image:r?.metatags?.[0]?.["og:image"]})));return{data:a}}catch(e){return{error:e.message}}}],[/\/?webpageToText\("(.*)"\)/,async e=>{try{let t=await openkbs.webpageToText(e[1]);if(!t?.url)return{data:{error:"Unable to read website"}};return{data:t}}catch(e){return{error:e.response?.data||e}}}],[/\/?documentToText\("(.*)"\)/,async e=>{try{let t=await openkbs.documentToText(e[1]);return{data:t}}catch(e){return{error:e.response.data}}}],[/\/?imageToText\("(.*)"\)/,async e=>{try{let t=await openkbs.imageToText(e[1]);if(t?.detections?.[0]?.txt){t={detections:t?.detections?.[0]?.txt}}return{data:t}}catch(e){return{error:e.response.data}}}]];const backendHandler=async e=>{const t=e.payload.messages[e.payload.messages.length-1];const a=getActions();const r=a.reduce(((a,[r,n])=>{const o=[...t.content.matchAll(new RegExp(r,"g"))];o.forEach((t=>{a.push(n(t,e))}));return a}),[]);const n=e?.payload?.messages?.length>60;if(r.length>0){try{const e=await Promise.all(r);const t=e.length===1&&(e[0]?.type==="JOB_COMPLETED"||e[0]?.type==="JOB_FAILED");const a={_meta_actions:n||t?[]:["REQUEST_CHAT_MODEL"]};if(e?.[0]?.data?.some?.((e=>e?.type==="image_url"))){return{...e[0],...a}}return{type:"RESPONSE",data:e,...a}}catch(e){return{type:"ERROR",error:e.message,_meta_actions:n?[]:["REQUEST_CHAT_MODEL"]}}}return{type:"CONTINUE"}};const handler=async e=>backendHandler(e);module.exports=t})();